(()=>{"use strict";function t(t,i){return Math.floor(Math.random()*(i-t)+t)}function i(t){return t>=100?1:t<0?0:t/100}function e(t){return t>=10&&(t=10),t<0&&(t=1),501-50*t}function s(t){return null==t}function n(t,i){return o(t.getAttribute(i))}function o(t){return t?document.querySelectorAll(function(t){return t.replace(/#([^\s"#']+)/g,((t,i)=>`#${CSS.escape(i)}`))}(t)):[]}function a(t,i,e){let s=[];for(const n of t){let t=o(n.getAttribute(e)),a=!1;for(const e of t)if(e.isEqualNode(i)){a=!0;break}a&&s.push(n)}return s}class h{constructor(t={}){this.snakeColor=t.snakeColor||"#2e3434",this.appleColor=t.appleColor||"#2e3434",this.pointSizePx=t.pointSizePx||16,this.pointPadding=t.pointPadding||4,this.centerX=0,this.centerY=0,this.snakeStartSize=t.snakeStartSize||3,this.haveWalls=!("haveWalls"in t)||t.haveWalls,this.mute=!("mute"in t)||t.mute,t.gameVolume?this.gameVolume=i(t.gameVolume):this.gameVolume=.001,this.gameTick=t.gameTick||10,t.snakeTick?this.snakeTick=e(t.snakeTick):this.snakeTick=300,this.appleTick=t.appleTick||50,this.gameOverStatus=!1}}const c="data-ipa-snake-game-parent";class r{constructor(t,i){this.config=i,this.speedSettingsElements=n(t,"data-ipa-snake-game-s-speed"),this.wallsSettingsElements=n(t,"data-ipa-snake-game-s-walls"),this.soundsSettingsElements=n(t,"data-ipa-snake-game-s-sounds"),this.volumeSettingsElements=n(t,"data-ipa-snake-game-s-volume"),this.initSettings()}initSettings(){for(const t of this.speedSettingsElements)this.setSpeed(t.value),t.addEventListener("input",(t=>{this.setSpeed(t.target.value)}));for(const t of this.wallsSettingsElements)this.setWalls(t.checked),t.addEventListener("click",(t=>{this.setWalls(t.target.checked)}));for(const t of this.soundsSettingsElements)this.mute(!t.checked),t.addEventListener("click",(t=>{this.mute(!t.target.checked)}));for(const t of this.volumeSettingsElements)this.setVolume(t.value),t.addEventListener("input",(t=>{this.setVolume(t.target.value)}))}mute(t){this.config.mute=!!t}setSpeed(t){this.config.snakeTick=e(t)}setVolume(t){this.config.gameVolume=i(t)}setWalls(t){this.config.haveWalls=t}}class l{constructor(t,i,e,s,n,h){this.start=t,this.stop=i,this.pause=e,this.reset=s,this.container=n,this.actionStartElements=a(o('[data-ipa-snake-game="start"]'),this.container,c),this.actionStopElements=a(o('[data-ipa-snake-game="stop"]'),this.container,c),this.actionPauseElements=a(o('[data-ipa-snake-game="pause"]'),this.container,c),this.actionResetElements=a(o('[data-ipa-snake-game="reset"]'),this.container,c),this.initActions()}initActions(){this.actionStartElements.length||this.start();for(const t of this.actionStartElements)t.addEventListener("click",(t=>{this.start()}));for(const t of this.actionStopElements)t.addEventListener("click",(t=>{this.stop()}));for(const t of this.actionPauseElements)t.addEventListener("click",(t=>{this.pause()}));for(const t of this.actionResetElements)t.addEventListener("click",(t=>{this.reset()}))}}class p{constructor(t,i){this.container=t,this.config=i,this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.element.width=20*i.pointSizePx,this.element.height=26*i.pointSizePx,this.element.classList.add("ipa-snake-game-canvas"),this.container.querySelector(".ipa-snake-game-canvas-wrapper").appendChild(this.element),this.config.centerX=this.getCenterX(),this.config.centerY=this.getCenterY()}getCenterX(){return Math.floor(this.element.width/this.config.pointSizePx/2)*this.config.pointSizePx}getCenterY(){return Math.floor(this.element.height/this.config.pointSizePx/2)*this.config.pointSizePx}drawCell(t,i,e){this.context.fillStyle=e,this.context.strokeStyle=e,this.context.strokeRect(t,i,this.config.pointSizePx,this.config.pointSizePx),this.context.fillRect(t+this.config.pointPadding,i+this.config.pointPadding,this.config.pointSizePx-2*this.config.pointPadding,this.config.pointSizePx-2*this.config.pointPadding)}drawWalls(t){this.context.strokeStyle=t,this.context.strokeRect(0,0,this.element.width,this.element.height)}clearFull(){this.clearCell(0,0,this.element.width,this.element.height)}clearCell(t,i,e,s){this.context.clearRect(t,i,e,s)}}class g{constructor(t){this.container=t,this.btnUp=this.container.querySelector(".ipa-snake-js-control-up"),this.btnDown=this.container.querySelector(".ipa-snake-js-control-down"),this.btnLeft=this.container.querySelector(".ipa-snake-js-control-left"),this.btnRight=this.container.querySelector(".ipa-snake-js-control-right")}}class m{constructor(t,i=0){this.container=t,this.scoreBlock=this.container.querySelector(".ipa-snake-game-score .ipa-snake-game-score-count"),this.score=i,this.draw()}incScore(){this.score++,this.draw()}setToZero(){this.score=0,this.draw()}draw(){this.scoreBlock.innerHTML=this.score}}class d{constructor(t,i,e){this.config=t,this.canvas=i,this.x=this.config.centerX,this.y=this.config.centerY,this.speedX=this.config.pointSizePx,this.speedY=0,this.points=[],this.maxPoints=this.config.snakeStartSize,this.moveAudio=new Audio,this.moveAudio.preload="auto",this.moveAudio.src="../audio/mr_9999_14.wav",this.gameOverAudio=new Audio,this.gameOverAudio.preload="auto",this.gameOverAudio.src="../audio/mr_9999_08.wav",this.config.gameOverStatus=!1,this.control(e)}update(t,i){this.x+=this.speedX,this.y+=this.speedY,this.x<0?this.config.haveWalls?this.config.gameOverStatus=!0:this.x=this.canvas.element.width-this.config.pointSizePx:this.x>=this.canvas.element.width&&(this.config.haveWalls?this.config.gameOverStatus=!0:this.x=0),this.y<0?this.config.haveWalls?this.config.gameOverStatus=!0:this.y=this.canvas.element.height-this.config.pointSizePx:this.y>=this.canvas.element.height&&(this.config.haveWalls?this.config.gameOverStatus=!0:this.y=0),this.points.unshift({x:this.x,y:this.y}),this.points.length>this.maxPoints&&this.points.pop(),this.points.forEach(((e,s)=>{e.x===t.x&&e.y===t.y&&(t.startEatSound(),this.maxPoints++,i.incScore(),t.randomPosition());for(let t=s+1;t<this.points.length;t++)e.x===this.points[t].x&&e.y===this.points[t].y&&(this.config.gameOverStatus=!0)})),this.config.gameOverStatus&&(this.gameOver(),i.setToZero(),t.randomPosition())}checkIfTurnBack(t,i){if(void 0===this.points[1])return!1;let e=this.x+t,s=this.y+i;return this.points[1].x===e&&this.points[1].y===s}draw(){this.points.forEach(((t,i)=>{this.canvas.drawCell(t.x,t.y,this.config.snakeColor)}))}startMoveSound(){this.config.mute||(this.moveAudio.volume=this.config.gameVolume,this.moveAudio.play().then((t=>{})))}stopMoveSound(){this.config.mute||(this.moveAudio.pause(),this.moveAudio.currentTime=0)}startGameOverSound(){this.config.mute||(this.gameOverAudio.volume=this.config.gameVolume,this.gameOverAudio.play().then((t=>{})))}stopGameOverSound(){this.config.mute||(this.gameOverAudio.pause(),this.gameOverAudio.currentTime=0)}gameOver(){this.startGameOverSound(),this.x=this.config.centerX,this.y=this.config.centerY,this.speedX=this.config.pointSizePx,this.speedY=0,this.points=[],this.maxPoints=this.config.snakeStartSize}control(t){s(t.btnUp)||t.btnUp.addEventListener("click",(async t=>{this.moveUp()})),s(t.btnDown)||t.btnDown.addEventListener("click",(async t=>{this.moveDown()})),s(t.btnDown)||t.btnLeft.addEventListener("click",(async t=>{this.moveLeft()})),s(t.btnDown)||t.btnRight.addEventListener("click",(async t=>{this.moveRight()})),document.addEventListener("keydown",(t=>{switch(t.code){case"KeyW":case"ArrowUp":case"Numpad8":t.preventDefault(),this.moveUp();break;case"KeyS":case"ArrowDown":case"Numpad2":t.preventDefault(),this.moveDown();break;case"KeyA":case"ArrowLeft":case"Numpad4":t.preventDefault(),this.moveLeft();break;case"KeyD":case"ArrowRight":case"Numpad6":t.preventDefault(),this.moveRight()}}))}moveUp(){this.checkIfTurnBack(0,-this.config.pointSizePx)||(this.speedX=0,this.speedY=-this.config.pointSizePx)}moveDown(){this.checkIfTurnBack(0,this.config.pointSizePx)||(this.speedX=0,this.speedY=this.config.pointSizePx)}moveLeft(){this.checkIfTurnBack(-this.config.pointSizePx,0)||(this.speedX=-this.config.pointSizePx,this.speedY=0)}moveRight(){this.checkIfTurnBack(this.config.pointSizePx,0)||(this.speedX=this.config.pointSizePx,this.speedY=0)}}class u{constructor(t,i){this.config=t,this.canvas=i,this.x=0,this.y=0,this.show=!0,this.eatAudio=new Audio,this.eatAudio.preload="auto",this.eatAudio.src="../audio/browser-games/snake/mr_9999_05.wav",this.randomPosition()}draw(t=!1){t&&(this.show=!this.show),this.canvas.clearCell(this.x,this.y,this.config.pointSizePx,this.config.pointSizePx),this.show&&this.canvas.drawCell(this.x,this.y,this.config.appleColor)}randomPosition(){this.x=t(0,this.canvas.element.width/this.config.pointSizePx)*this.config.pointSizePx,this.y=t(0,this.canvas.element.height/this.config.pointSizePx)*this.config.pointSizePx}startEatSound(){this.config.mute||(this.eatAudio.volume=this.config.gameVolume,this.eatAudio.play().then((t=>{})))}stopEatSound(){this.config.mute||(this.eatAudio.pause(),this.eatAudio.currentTime=0)}}class f{constructor(t,i,e,s){this.snakeUpdate=t,this.snakeDraw=i,this.appleDraw=e,this.config=s,this.gameTime=Date.now(),this.snakeTime=Date.now(),this.appleTime=Date.now(),this.gameTickTimer=void 0}gameTick(){if(this.config.gameOverStatus)return this.stop(),void this.snakeUpdate();this.gameTime=Date.now(),this.gameTime-this.snakeTime>this.config.snakeTick&&(this.snakeTime=Date.now(),this.snakeUpdate(),this.snakeDraw()),this.gameTime-this.appleTime>this.config.appleTick&&(this.appleTime=Date.now(),this.appleDraw())}start(){this.isActive()||(this.gameTickTimer=setInterval((()=>{this.gameTick()}),this.config.gameTick))}stop(){this.isActive()&&(clearInterval(this.gameTickTimer),this.gameTickTimer=void 0)}isActive(){return!(void 0===this.gameTickTimer)}}new class{constructor(t,i={}){null!==t&&(this.config=new h(i),this.settings=new r(t,this.config),this.canvas=new p(t,this.config),this.controls=new g(t),this.score=new m(t,0),this.snake=new d(this.config,this.canvas,this.controls),this.apple=new u(this.config,this.canvas),this.loop=new f(this.updateSnake.bind(this),this.drawSnake.bind(this),this.drawApple.bind(this),this.config),this.actions=new l(this.start.bind(this),this.stop.bind(this),this.pause.bind(this),this.reset.bind(this),t,this.config))}start(){this.loop.start()}stop(){this.loop.stop(),this.snake.gameOver(),this.score.setToZero(),this.canvas.clearFull()}pause(){this.loop.isActive()&&this.loop.stop()}reset(){this.loop.isActive()&&(this.loop.stop(),this.snake.gameOver(),this.score.setToZero(),this.apple.randomPosition(),this.loop.start())}updateSnake(){this.config.gameOverStatus?this.drawGameOver():this.snake.update(this.apple,this.score)}drawSnake(){this.snake.stopMoveSound(),this.canvas.clearFull(),this.snake.startMoveSound(),this.snake.draw(),this.apple.draw(),this.config.haveWalls&&this.canvas.drawWalls()}drawApple(){this.apple.draw(this.canvas,!0)}drawGameOver(){for(let t=0;t<this.canvas.element.height;t+=this.config.pointSizePx)for(let i=0;i<this.canvas.element.width;i+=this.config.pointSizePx)this.canvas.drawCell(i,t,this.config.snakeColor);this.config.gameOverStatus=!1}}(document.querySelector('[data-ipa-snake-game="init"]'))})();